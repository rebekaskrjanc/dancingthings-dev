angular.module("dancingthings",["ngRoute","ngSanitize","ui.bootstrap","vcRecaptcha"]).config(["$routeProvider","$locationProvider",function(n,a){n.when("/",{templateUrl:"homepage/homepage.news.html",controller:"homepageCtrl",controllerAs:"vm"}).when("/groups",{templateUrl:"groups/pogledi/groups.pogled.html",controller:"groupsCtrl",controllerAs:"vm"}).when("/members",{templateUrl:"members/pogledi/members.pogled.html",controller:"membersCtrl",controllerAs:"vm"}).when("/myprofile",{templateUrl:"myprofile/pogledi/myprofile.pogled.html",controller:"membersCtrl",controllerAs:"vm"}).when("/signup",{templateUrl:"signup/pogledi/signup.pogled.html",controllerAs:"vm"}).when("/registracija",{templateUrl:"/avtentikacija/registracija/registracija.pogled.html",controller:"registracijaCtrl",controllerAs:"vm"}).when("/prijava",{templateUrl:"/avtentikacija/prijava/prijava.pogled.html",controller:"prijavaCtrl",controllerAs:"vm"}).when("/logout",{templateUrl:"/logout/logout.pogled.html",controllerAs:"vm"}).when("/db",{templateUrl:"/db/db.html",controller:"dbCtrl",controllerAs:"vm"}).otherwise({redirecTo:"/"}),a.html5Mode(!0)}]),function(){function n(n,a,t,o,i,e,r){var u=this;return u.jePrijavljen=i.jePrijavljen(),u.prvotnaStran=a.path(),u.trenutniUporabnik=i.trenutniUporabnik(),console.log(u.trenutniUporabnik),u.pagination={search:"",page:0},u.currPage=1,u.pridobiPodatke=function(n){u.sporocilo="Iščem bližnje lokacije.",u.pageNumber=1,u.mejaUp=10*n,u.mejaDown=u.mejaUp-10,u.objave=[],console.log(u.mejaDown,u.mejaUp),o.vsebinaObjave().then(function(n){for(u.objavePredFiltrom=n.data,u.objavePredFiltrom.reverse(),l=u.objavePredFiltrom.length;10<l;)l-=10,u.pageNumber+=1;var a,o,i;if(u.mejaUp>u.objavePredFiltrom.length)for(console.log("prvi"),a=u.mejaDown;a<u.objavePredFiltrom.length;a++)u.objave.push(u.objavePredFiltrom[a]);else for(console.log("drugi"),o=u.mejaDown;o<u.mejaUp;o++)u.objave.push(u.objavePredFiltrom[o]);for(i=0;i<u.objave.length;i++)coms=u.objave[i].comments+"",coms=coms.split(","),u.objave[i].comments=coms;u.objave.comments},function(n){u.sporocilo="Prišlo je do napake!",console.log(n.e)})},u.pridobiPodatke(u.currPage),u.prevPage=function(){u.currPage-=1,u.pridobiPodatke(u.currPage)},u.nextPage=function(){u.currPage+=1,u.pridobiPodatke(u.currPage)},u.postUI=function(o,n){t.open({templateUrl:"/postModalnoOkno/postModalnoOkno.html",controller:"postModalnoOkno",controllerAs:"vm",resolve:{podrobnostiObjave:function(){return{idObjave:o,vsebina:n}}}}).result.then(function(n){if(void 0!==n)var a;for(a=0;a<u.objave.length;a++)u.objave[a]._id==o&&(u.objave[a].text=n.text,u.objave[a].postAuthor=n.postAuthor);u.pridobiPodatke(u.currPage)},function(n){})},u.novaObjava=function(){o.newPost({text:u.podatkiObrazca.text,imeUporabnika:u.trenutniUporabnik.username}).then(function(n){console.log("uspešno"),u.pridobiPodatke(u.currPage)},function(n){console.log("neuspešno",n)})},u.novKomentar=function(o,n,a,i){t.open({templateUrl:"/commentModalnoOkno/commentModalnoOkno.html",controller:"commentModalnoOkno",controllerAs:"vm",resolve:{podrobnostiKom:function(){return{idObjave:o,komentarji:n,vsebina:a,author:i}}}}).result.then(function(n){var a;if(c=n.comments.split(","),void 0!==n)for(a=0;a<u.objave.length;a++)u.objave[a]._id==o&&(u.objave[a].comments=c)},function(n){})},u.pridobiUporabnike=function(){e.allMembers().then(function(n){u.users=n.data},function(n){u.sporocilo="Prišlo je do napake!",console.log(n.e)})},u.pridobiUporabnike(),u.pridobiSkupine=function(){r.allGroups().then(function(n){u.groups=n.data},function(n){u.sporocilo="Prišlo je do napake!",console.log(n.e)})},u.pridobiSkupine(),u.o=u.objave+"",u.displayItems=u.o.slice(0,3),u.pageChanged=function(){u.page;return console.log(u.page),u},u}n.$inject=["$scope","$location","$uibModal","dancingthingsPodatki","avtentikacija","dancingthingsMembers","dancingthingsGroups"],angular.module("dancingthings").controller("homepageCtrl",n)}(),function(){function n(n,a,i,o,t){var e=this;return e.jePrijavljen=t.jePrijavljen(),e.prvotnaStran=a.path(),e.trenutniUporabnik=t.trenutniUporabnik(),e.glavaStrani={naslov:"EduGeoCache",podnaslov:"Poiščite zanimive lokacije blizu vas!"},e.pridobiSkupine=function(){o.allGroups().then(function(n){e.groups=n.data},function(n){e.sporocilo="Prišlo je do napake!",console.log(n.e)})},e.pridobiSkupine(),e.groupUI=function(){i.open({templateUrl:"/groupModalnoOkno/groupModalnoOkno.pogled.html",controller:"groupModalnoOkno",controllerAs:"vm"}).result.then(function(n){void 0!==n&&e.groups.push(n)},function(n){})},e.editGroupUI=function(o,n){i.open({templateUrl:"/editGroupModalnoOkno/editGroupModalnoOkno.html",controller:"editGroupModalnoOkno",controllerAs:"vm",resolve:{podrobnostiSkupine:function(){return{idSkupine:o,name:n}}}}).result.then(function(n){if(void 0!==n)var a;for(a=0;a<e.groups.length;a++)e.groups[a]._id==o&&(e.groups[a].groupName=n.groupName,e.groups[a].about=n.groupName);e.pridobiSkupine()},function(n){})},e}n.$inject=["$scope","$location","$uibModal","dancingthingsGroups","avtentikacija"],angular.module("dancingthings").controller("groupsCtrl",n)}(),function(){function n(n,a,i,o,t,e){var r=this;return r.jePrijavljen=e.jePrijavljen(),r.prvotnaStran=a.path(),r.id=0,r.name="",r.nalaganje="Loading posts.",r.trenutniUporabnik=e.trenutniUporabnik(),r.glavaStrani={naslov:"EduGeoCache",podnaslov:"Poiščite zanimive lokacije blizu vas!"},r.pridobiUporabnike=function(){o.allMembers().then(function(n){r.users=n.data},function(n){r.sporocilo="Prišlo je do napake!",console.log(n.e)})},r.pridobiUporabnike(),r.pridobiPodatke=function(){r.sporocilo="Iščem bližnje lokacije.",t.vsebinaObjave().then(function(n){var a;for(r.objave=n.data,a=0;a<r.objave.length;a++)coms=r.objave[a].comments+"",coms=coms.split(","),r.objave[a].comments=coms;r.objave.comments},function(n){r.sporocilo="Prišlo je do napake!",console.log(n.e)})},r.pridobiPodatke(),r.editProfileUI=function(n,o){var a;for(r.name=o,a=0;a<n.length;a++)n[a].username==o&&(r.id=n[a]._id);i.open({templateUrl:"/editProfileModalnoOkno/editProfileModalnoOkno.html",controller:"editProfileModalnoOkno",controllerAs:"vm",resolve:{podrobnostiUporabnika:function(){return{idUporabnika:r.id}}}}).result.then(function(n){var a;for(void 0!==n&&console.log("edit podatki",n),r.trenutniUporabnik.username=n.username,r.trenutniUporabnik.email=n.email,console.log("spremenjen user",r.trenutniUporabnik),a=0;a<r.users.length;a++)r.users[a].username==o&&(r.users[a].username=n.username,r.users[a].email=n.email)},function(n){})},r}n.$inject=["$scope","$location","$uibModal","dancingthingsMembers","dancingthingsPodatki","avtentikacija"],angular.module("dancingthings").controller("membersCtrl",n)}(),function(){function n(a,o){var i=this;i.glavaStrani={naslov:"Kreiranje novega Dancing Things uporabniškega računa"},i.prijavniPodatki={username:"",email:"",password:"",firstname:"",city:"",state:"",dance:"",recaptchaResponse:""},i.prvotnaStran=a.search().stran||"/",i.posiljanjePodatkov=function(n){if(console.log(n),i.prijavniPodatki.dance=n,console.log("prijavni podatki",i.prijavniPodatki),i.napakaNaObrazcu="",!(i.prijavniPodatki.username&&i.prijavniPodatki.email&&i.prijavniPodatki.password&&i.prijavniPodatki.password2&&i.prijavniPodatki.city&&i.prijavniPodatki.state&&i.prijavniPodatki.dance&&i.prijavniPodatki.firstname))return!(i.napakaNaObrazcu="Zahtevani so vsi podatki, prosim poskusite znova!");i.prijavniPodatki.recaptchaResponse?i.izvediRegistracijo(i.prijavniPodatki):i.napakaNaObrazcu="Potrdite da niste robot!"},i.izvediRegistracijo=function(n){console.log("izvajamR",n),i.napakaNaObrazcu="",o.registracija(n).then(function(n){a.search("stran",null),a.path(i.prvotnaStran)},function(n){i.napakaNaObrazcu=n.data.sporocilo})}}n.$inject=["$location","avtentikacija"],angular.module("dancingthings").controller("registracijaCtrl",n)}(),function(){function n(a,n){var o=this;o.glavaStrani={naslov:"Prijava v Dancing Things"},o.prijavniPodatki={email:"",password:""},o.prvotnaStran=a.search().stran||"/",o.posiljanjePodatkov=function(){if(o.napakaNaObrazcu="",!o.prijavniPodatki.email||!o.prijavniPodatki.password)return!(o.napakaNaObrazcu="Zahtevani so vsi podatki, prosim poskusite znova!");o.izvediPrijavo()},o.izvediPrijavo=function(){o.napakaNaObrazcu="",n.prijava(o.prijavniPodatki).then(function(n){a.search("stran",null),a.path(o.prvotnaStran)},function(n){o.napakaNaObrazcu=n.data.sporocilo})}}n.$inject=["$location","avtentikacija"],angular.module("dancingthings").controller("prijavaCtrl",n)}(),function(){function n(n,a,o,i,t){var e=this;e.trenutnaLokacija=a.path(),e.jePrijavljen=i.jePrijavljen(),e.trenutniUporabnik=i.trenutniUporabnik(),e.prijavniPodatki={username:"",email:"",password:"",firstname:"",city:"",state:"",dance:""},e.prvotnaStran=a.search().stran||"/db",e.posiljanjePodatkov=function(n){if(console.log(n),e.prijavniPodatki.dance=n,console.log("prijavni podatki",e.prijavniPodatki),e.napakaNaObrazcu="",!(e.prijavniPodatki.username&&e.prijavniPodatki.email&&e.prijavniPodatki.password&&e.prijavniPodatki.password2&&e.prijavniPodatki.city&&e.prijavniPodatki.state&&e.prijavniPodatki.dance&&e.prijavniPodatki.firstname))return e.napakaNaObrazcu="Zahtevani so vsi podatki, prosim poskusite znova!",console.log(e.prijavniPodatki.username,e.prijavniPodatki.email,e.prijavniPodatki.password,e.prijavniPodatki.password2,e.prijavniPodatki.city,e.prijavniPodatki.state,e.prijavniPodatki.dance,e.prijavniPodatki.firstname),!1;e.izvediRegistracijo(e.prijavniPodatki)},e.izvediRegistracijo=function(n){console.log("izvajamR",n),e.napakaNaObrazcu="",i.registracija(n).then(function(n){a.search("stran",null),a.path(e.prvotnaStran)},function(n){e.napakaNaObrazcu=n.data.sporocilo})},e.posiljanjePodatkovSkupine=function(){return e.napakaNaObrazcu="",e.groupName&&e.aboutGroup?(e.dodajSkupino(e.groupName,e.aboutGroup),!1):!(e.napakaNaObrazcu="Prosim, izpolnite vsa vnosna polja!")},e.dodajSkupino=function(n,a){o.newGroup({groupName:n,about:a,groupAdmin:e.trenutniUporabnik.username}).then(function(n){alert("Group added successfully!")},function(n){alert("Group creation failed"),e.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"})},e.novaObjava=function(){console.log("posti",e.vsebinaObjave),t.newPost({text:e.vsebinaObjave,imeUporabnika:e.trenutniUporabnik.username}).then(function(n){alert("A new post was created, you can see it on the home page!")},function(n){alert("Post creation failed")})},e.deleteDB=function(){return console.log("brišem...skor"),n.get("/api/deleteUserDB").then(function(n){alert("Database successfully dropped!")})}}n.$inject=["$http","$location","dancingthingsGroups","avtentikacija","dancingthingsPodatki"],angular.module("dancingthings").controller("dbCtrl",n)}(),function(){function n(n,a,o,i,t){var e=this;return e.jePrijavljen=t.jePrijavljen(),e.prvotnaStran=a.path(),e.glavaStrani={naslov:"EduGeoCache",podnaslov:"Poiščite zanimive lokacije blizu vas!"},e.users,e.stranskaOrodnaVrstica="Iščete lokacijo za kratkočasenje? EduGeoCache vam pomaga pri iskanju zanimivih lokacij v bližini. Mogoče imate kakšne posebne želje? Naj vam EduGeoCache pomaga pri iskanju bližnjih zanimivih lokacij.",e.pridobiUporabnike=function(){i.allMembers().then(function(n){e.users=n.data},function(n){e.sporocilo="Prišlo je do napake!",console.log(n.e)})},e.pridobiUporabnike(),e}n.$inject=["$scope","$location","$uibModal","dancingthingsMembers","avtentikacija"],angular.module("dancingthings").controller("myprofileCtrl",n)}(),function(){function n(n){this.modalnoOkno={preklici:function(){n.close()}}}n.$inject=["$uibModalInstance"],angular.module("dancingthings").controller("komentarModalnoOkno",n)}(),function(){function n(n,a,o,i){var t=this;t.trenutnaLokacija=n.path(),t.jePrijavljen=i.jePrijavljen(),t.trenutniUporabnik=i.trenutniUporabnik(),t.modalnoOknoGroups={preklici:function(){a.close()},zapri:function(n){a.close(n)}},t.posiljanjePodatkov=function(){return t.napakaNaObrazcu="",t.podatkiObrazca.groupName?(t.dodajSkupino(t.podatkiObrazca),console.log(t.podatkiObrazca),!1):!(t.napakaNaObrazcu="Prosim, izpolnite vsa vnosna polja!")},t.dodajSkupino=function(n){o.newGroup({groupName:n.groupName,about:n.about,groupAdmin:t.trenutniUporabnik.username}).then(function(n){t.modalnoOknoGroups.zapri(n.data)},function(n){t.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"})}}n.$inject=["$location","$uibModalInstance","dancingthingsGroups","avtentikacija"],angular.module("dancingthings").controller("groupModalnoOkno",n)}(),function(){function n(n,a,o,i,t){var e=this;e.trenutnaLokacija=n.path(),e.jePrijavljen=t.jePrijavljen(),e.trenutniUporabnik=t.trenutniUporabnik(),e.podrobnostiSkupine=o,e.modalnoOknoEditGroups={preklici:function(){a.close()},zapri:function(n){a.close(n)}},e.zbrisiSkupino=function(){if(e.id=o.idSkupine,!e.id)return!(e.napakaNaObrazcu="Napačen id skupine!");i.deleteGroup(e.id).then(function(n){e.modalnoOknoEditGroups.zapri(n.data)},function(n){e.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"})},e.posiljanjePodatkov=function(n){if(e.napakaNaObrazcu="",!e.podatkiObrazca.groupName&&!e.podatkiObrazca.about)return!(e.napakaNaObrazcu="Prosim, izpolnite vsaj eno vnosno polje!");e.urediSkupino(e.podatkiObrazca,n)},e.urediSkupino=function(n,a){i.editGroup(a,{groupName:n.groupName,about:n.about}).then(function(n){e.modalnoOknoEditGroups.zapri(n.data)},function(n){e.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"})}}n.$inject=["$location","$uibModalInstance","podrobnostiSkupine","dancingthingsGroups","avtentikacija"],angular.module("dancingthings").controller("editGroupModalnoOkno",n)}(),function(){function n(n,a,o,i,t){var e=this;e.trenutnaLokacija=n.path(),e.jePrijavljen=t.jePrijavljen(),e.trenutniUporabnik=t.trenutniUporabnik(),e.podrobnostiObjave=o,e.modalnoOknoPost={preklici:function(){a.close()},zapri:function(n){a.close(n)}},e.zbrisiObjavo=function(n){if(!n)return!(e.napakaNaObrazcu="Napačen id skupine!");i.deletePost(n).then(function(n){e.modalnoOknoPost.zapri(n.data)},function(n){e.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"})},e.posiljanjePodatkov=function(n,a){if(e.napakaNaObrazcu="",!e.podatkiObrazca.text)return!(e.napakaNaObrazcu="Prosim, izpolnite vsaj eno vnosno polje!");e.urediObjavo(e.podatkiObrazca,n,a)},e.urediObjavo=function(n,a,o){console.log("log",a,n),i.editPost(a,{text:n.text,postAuthor:o}).then(function(n){e.modalnoOknoPost.zapri(n.data)},function(n){e.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"})}}n.$inject=["$location","$uibModalInstance","podrobnostiObjave","dancingthingsPodatki","avtentikacija"],angular.module("dancingthings").controller("postModalnoOkno",n)}(),function(){function n(n,a,o,e,i){var r=this;r.trenutnaLokacija=n.path(),r.jePrijavljen=i.jePrijavljen(),r.trenutniUporabnik=i.trenutniUporabnik(),r.podrobnostiKom=o,r.modalnoOknoComment={preklici:function(){a.close()},zapri:function(n){a.close(n)}},r.zbrisiObjavo=function(n,a){if(console.log("prvi",n,a),!n)return!(r.napakaNaObrazcu="Napačen id skupine!");e.deletePost(n).then(function(n){r.modalnoOknoComment.zapri(n.data)},function(n){r.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"})},r.posiljanjePodatkov=function(n,a,o,i){if(r.napakaNaObrazcu="",!r.podatkiObrazca.text)return!(r.napakaNaObrazcu="Prosim, izpolnite vsaj eno vnosno polje!");console.log("drugi",n,a,o,i),r.urediObjavo(r.podatkiObrazca,n,o,a,i)},r.urediObjavo=function(n,a,o,i,t){console.log("author",t),""==i?e.editPost(a,{text:o,postAuthor:t,comments:n.text}).then(function(n){console.log("data",n.data),r.modalnoOknoComment.zapri(n.data)},function(n){r.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"}):e.editPost(a,{text:o,postAuthor:t,comments:i+","+n.text}).then(function(n){r.modalnoOknoComment.zapri(n.data)},function(n){r.napakaNaObrazcu="Napaka pri shranjevanju skupine, poskusite znova!"})}}n.$inject=["$location","$uibModalInstance","podrobnostiKom","dancingthingsPodatki","avtentikacija"],angular.module("dancingthings").controller("commentModalnoOkno",n)}(),function(){var n=function(o,i){return{vsebinaObjave:function(){return o.get("/api/posts")},newPost:function(n){return o.post("/api/posts",n,{headers:{Authorization:"Bearer "+i.vrniZeton()}})},editPost:function(n,a){return console.log("2. console",n,a),o.put("/api/posts/"+n,a,{headers:{Authorization:"Bearer "+i.vrniZeton()}})},deletePost:function(n){return o.delete("/api/posts/"+n,{headers:{Authorization:"Bearer "+i.vrniZeton()}})}}};n.$inject=["$http","avtentikacija"],angular.module("dancingthings").service("dancingthingsPodatki",n)}(),function(){var n=function(o,i){return{allGroups:function(){return o.get("/api/groups")},newGroup:function(n){return console.log(n),o.post("/api/groups",n,{headers:{Authorization:"Bearer "+i.vrniZeton()}})},editGroup:function(n,a){return o.put("/api/groups/"+n,a,{headers:{Authorization:"Bearer "+i.vrniZeton()}})},deleteGroup:function(n){return o.delete("/api/groups/"+n,{headers:{Authorization:"Bearer "+i.vrniZeton()}})}}};n.$inject=["$http","avtentikacija"],angular.module("dancingthings").service("dancingthingsGroups",n)}(),function(){var n=function(o,i){return{allMembers:function(){return o.get("/api/users")},newMember:function(n){return o.post("/api/users",n)},editUser:function(n,a){return o.put("/api/users/"+n,a,{headers:{Authorization:"Bearer "+i.vrniZeton()}})}}};n.$inject=["$http","avtentikacija"],angular.module("dancingthings").service("dancingthingsMembers",n)}(),function(){function n(a,o){var i=function(n){return decodeURIComponent(Array.prototype.map.call(a.atob(n),function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""))},t=function(n){a.localStorage["dancingthings-zeton"]=n},e=function(){return a.localStorage["dancingthings-zeton"]},r=function(){var n=e();return!!n&&JSON.parse(i(n.split(".")[1])).datumPoteka>Date.now()/1e3};return{shraniZeton:t,vrniZeton:e,registracija:function(n){return console.log("storitev",n),o.post("/api/registracija",n).then(function(n){console.log("po apiju",n.data),t(n.data.zeton)})},prijava:function(n){return o.post("/api/prijava",n).then(function(n){t(n.data.zeton)})},odjava:function(){a.localStorage.removeItem("dancingthings-zeton")},jePrijavljen:r,trenutniUporabnik:function(){if(console.log("koristna vsebina",a),r()){var n=e(),a=JSON.parse(i(n.split(".")[1]));return{email:a.email,username:a.username,firstname:a.firstname,city:a.city,state:a.state,dance:a.dance}}}}}n.$inject=["$window","$http"],angular.module("dancingthings").service("avtentikacija",n)}(),angular.module("dancingthings").filter("dodajHtmlPrehodVNovoVrstico",function(){return function(n){return n.replace(/\n/g,"<br/>")}}),angular.module("dancingthings").directive("noga",function(){return{restrict:"EA",templateUrl:"/skupno/direktive/noga/noga.predloga.html"}}),angular.module("dancingthings").directive("navigacija",function(){return{restrict:"EA",templateUrl:"/skupno/direktive/navigacija/navigacija.predloga.html",controller:"navigacijaCtrl",controllerAs:"navvm"}}),function(){function n(n,a,o){this.trenutnaLokacija=n.path(),this.jePrijavljen=a.jePrijavljen(),this.trenutniUporabnik=a.trenutniUporabnik(),this.odjava=function(){a.odjava(),n.path("/"),o.reload()}}n.$inject=["$location","avtentikacija","$route"],angular.module("dancingthings").controller("navigacijaCtrl",n)}(),angular.module("dancingthings").directive("glava",function(){return{restrict:"EA",templateUrl:"/skupno/direktive/glava/glava.predloga.html"}}),angular.module("dancingthings").directive("signout",function(){return{restrict:"EA",templateUrl:"/skupno/direktive/signout/signout.predloga.html",controller:"signoutCtrl",controllerAs:"navvm"}}),function(){function n(n,a,o){this.trenutnaLokacija=n.path(),this.jePrijavljen=a.jePrijavljen(),this.trenutniUporabnik=a.trenutniUporabnik(),this.odjava=function(){a.odjava(),n.path("/"),o.reload()}}n.$inject=["$location","avtentikacija","$route"],angular.module("dancingthings").controller("signoutCtrl",n)}();